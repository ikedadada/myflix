name = "myflix-backend"
main = "src/main.ts"
compatibility_date = "2024-06-15"

[observability]
[observability.logs]
enabled = true
invocation_log = false

[env.dev]
name = "myflix-backend-dev"
vars = { ENV_NAME = "dev", ACCESS_JWKS_URL = "https://example.cloudflareaccess.com/cdn-cgi/access/certs", ACCESS_JWT_AUD = "myflix-dev", CORS_ALLOWED_ORIGINS = "", GEMINI_MODEL = "gemini-2.5-pro" }

[[env.dev.d1_databases]]
binding = "DB"
database_name = "REPLACE_WITH_DEV_D1_NAME"
database_id = "REPLACE_WITH_DEV_D1_ID"
migrations_dir = "src/infrastructure/database/migrations"

[[env.dev.r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "myflix-dev-media"

[env.local]
name = "myflix-backend-local"
vars = { ENV_NAME = "local", ACCESS_JWKS_URL = "http://localhost/mock-jwks", ACCESS_JWT_AUD = "local", CORS_ALLOWED_ORIGINS = "*", GEMINI_MODEL = "gemini-2.5-pro" }

[[env.local.d1_databases]]
binding = "DB"
database_name = "myflix-local-db"
database_id = "local"
migrations_dir = "src/infrastructure/database/migrations"

[[env.local.r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "myflix-local-media"

[env.prod]
name = "myflix-backend-prod"
vars = { ENV_NAME = "prod", ACCESS_JWKS_URL = "https://example.cloudflareaccess.com/cdn-cgi/access/certs", ACCESS_JWT_AUD = "myflix-prod", CORS_ALLOWED_ORIGINS = "", GEMINI_MODEL = "gemini-2.5-pro" }

[[env.prod.d1_databases]]
binding = "DB"
database_name = "REPLACE_WITH_PROD_D1_NAME"
database_id = "REPLACE_WITH_PROD_D1_ID"
migrations_dir = "src/infrastructure/database/migrations"

[[env.prod.r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "myflix-prod-media"
