# TODO: 動画タグ機能の実装タスク（完了までの道筋）

## 要件固め
- [x] タグ仕様を決定（入力方式: 自由入力/候補選択、文字数/件数上限、正規化ルール、重複/大文字小文字の扱い）
- [x] フィルタ動作を定義（AND/OR、クエリパラメータ仕様、未指定時のデフォルト表示方針）
- [x] 既存動画の扱いと移行方針を決める（タグなしのまま表示/必要なら初期タグ付け）
  - 決定済み: 自由入力、前後空白除去＋NFKC正規化＋英字小文字化、1動画あたり最大10件・1タグ最大15文字
  - 決定済み: LLMでタイトル/説明生成と同時にタグも提案し、自動でフォームに反映（不要タグはユーザーが外す）
  - 決定済み: 既存動画はタグなしで開始し、手動またはLLM提案で付与
  - 決定済み: フィルタはANDを基本。ホームはフィルタUIではなくサジェスト用途で、マイライブラリの下にランダム抽出タグ3件分のカルーセルを追加し、カードクリックでそのタグ1件の結果を表示

## バックエンド
- [ ] スキーマ拡張：Video に tags を追加し、タグマスタ＋中間テーブルを定義（ユニーク制約と正規化カラムを含むマイグレーション）
- [ ] ドメイン/リポジトリ層にタグ追加・紐付け・取得のロジックを実装（バリデーションと重複排除）
- [ ] API変更：`GET /videos` に tags を含め、`?tags=` でフィルタ可能にする（AND/OR指定をサポート）
- [ ] API変更：`POST/PUT /videos` で tags を受け取り、作成/更新時に保存する
- [ ] `GET /tags`（サジェスト/人気タグ）エンドポイントを追加
- [ ] OpenAPI/型定義を更新し、既存クライアントとの互換性を確認

## フロントエンド
- [ ] 型更新：`VideoSummary` などに `tags: string[]` を追加し、APIクライアントとクエリを更新
- [ ] 表示：VideoCard・ホーム/ライブラリ一覧でタグをBadge表示（タグなしフォールバック含む）
- [ ] フィルタUI：ホーム/ライブラリにタグフィルタバーを追加し、選択タグをクエリキーに反映して再フェッチ（AND/OR切替対応）
- [ ] アップロードUI：Uploadフォームにタグ入力（複数入力・サジェスト・上限バリデーション）を追加し、送信ペイロードに含める
- [ ] 編集UI（必要なら）：既存動画のタグ編集を実装（フォーム初期値・更新API呼び出し）

## テスト・検証
- [ ] バックエンド：タグ付き/無し動画のCRUD、フィルタ動作、重複禁止・正規化のテストを追加
- [ ] フロント：タグ入力バリデーション、タグ表示、フィルタ操作（AND/OR）の挙動をVitest/RTLでカバー
- [ ] 手動/E2Eチェック：タグ付きアップロード→ホーム/ライブラリ表示→フィルタ確認→タグなし動画の表示確認

## ドキュメント・リリース
- [ ] フロント/バックエンドのAPI変更点と利用手順をドキュメント化
- [ ] 影響範囲のリリースノートと移行手順（既存動画の扱い）を用意
- [ ] Lint/ビルド/主要ブラウザでの確認を完了し、テスト結果を記録
